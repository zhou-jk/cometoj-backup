<html>

<head>
	<meta charset="utf-8" />
	<link rel="icon" href="../image/favicon.ico" sizes="32x32" />
	<link rel="icon" href="../image/favicon.ico" sizes="192x192" />
	<link rel="stylesheet" type="text/css" href="../static/semantic.min.css">
	<script src="../static/jquery.min.js" type="text/javascript"></script>
	<script src="../static/semantic.min.js" type="text/javascript"></script>
	<title>[Contest #9]【XR-3】系统设计</title>
	<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['$$$', '$$$']]
  },
  svg: {
    fontCache: 'global'
  }
};
	</script>
	<script type="text/javascript" id="MathJax-script" async src="../static/es5/tex-svg.js"></script>
</head>

<body>
	<div class="ui three item menu"><a class="header item" href="../index.html"><img src="../image/favicon.ico"> Comet OJ</a>
	</div>
	<div class="ui main container">
		<div class="ui center aligned grid">
			<div class="row">
				<h1 class="ui header">C1362 [Contest #9]【XR-3】系统设计</h1>
			</div>
				<div class="row" style="margin-top: -15px"><span class="ui label">内存限制：256 MB</span> <span class="ui label">时间限制：2500 ms</span></div>
		</div>
		<div class="ui grid">
			<div class="row">
				<div class="column">
					<h4 class="ui top attached block header">题目描述</h4>
					<div class="ui bottom attached segment font-content">
						<div style="position: relative; overflow: hidden;">
							<p style="margin-left: 0px;">小 X 需要你设计一个系统。</p><p>这个系统首先需要输入一棵 $n$ 个点的有根树和一个长度为 $m$ 的序列 $a$，接下来需要实现 $q$ 个操作。</p><p>操作分两种：</p><ol><li><code>1 x l r</code>表示设定起点为有根树的节点 $x$，接下来依次遍历 $l \sim r$。当遍历到 $i$ 时，从当前节点走向它的编号第 $a_i$ 小的儿子。如果某一时刻当前节点的儿子个数小于 $a_i$，或者已经遍历完 $l \sim r$，则在这个点停住，并输出这个点的编号，同时停止遍历。</li><li><code>2 t k</code>表示将序列中第 $t$ 个数 $a_t$ 修改为 $k$。</li></ol>
						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="column">
					<h4 class="ui top attached block header">输入格式</h4>
						<div class="ui bottom attached segment font-content">
						<div style="position: relative; overflow: hidden;">
							<div class=content>
								<p style="margin-left: 0px;">第一行 $3$ 个正整数 $n,m,q$，分别表示树的点数、序列的长度和操作个数。</p><p>第二行 $n$ 个整数 $f_{1 \dots n}$，其中 $f_i$ 表示点 $i$ 在树中的父亲节点编号，特别地，设根节点为 $rt$，则 $f_{rt} = 0$。</p><p>第三行 $m$ 个正整数 $a_{1 \dots m}$，表示序列 $a$。</p><p>接下来 $q$ 行，每行描述一个操作。</p><p>数据范围：</p><ul><li>$1 \le n,m,q \le 5 \times 10 ^ 5$。</li><li>$1 \le a_i \le n$。</li><li>对于操作 $1$，保证 $1 \le x \le n$，$1 \le l \le r \le m$。</li><li>对于操作 $2$，保证 $1 \le t \le m$，$1 \le k \le n$。</li></ul>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="column">
					<h4 class="ui top attached block header">输出</h4>
						<div class="ui bottom attached segment font-content">
						<div style="position: relative; overflow: hidden;">
							<div class=content>
								<p>对于每个操作 $1$，一行一个正整数，表示答案。<br></p>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="column">
					<h4 class="ui top attached block header">样例</h4>
						<div class="ui bottom attached segment font-content">
						<div style="position: relative; overflow: hidden;">
							<h4>样例输入 1</h4>
							<div class="ui existing segment">
								<pre style="margin-top:0; margin-bottom:0;"><code class="lang-plain"><div class=content><span class=sampledata>6 6 10
0 1 2 2 1 5
1 2 2 1 2 1
1 1 1 3
1 5 2 6
1 6 5 6
1 2 3 5
1 2 4 4
2 2 1
1 1 1 6
1 1 2 4
2 1 2
1 1 1 5
</span></div></code></pre>
							</div>
							<h4>样例输出 1</h4>
							<div class="ui existing segment">
								<pre style="margin-top:0; margin-bottom:0;"><code class="lang-plain"><div class=content><span class=sampledata>4
5
6
4
3
3
4
6
</span></div></code></pre>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="column">
					<h4 class="ui top attached block header">提示</h4>
						<div class="ui bottom attached segment font-content">
						<div style="position: relative; overflow: hidden;">
							<div class=content>
								<p style="margin-left: 0px;">本题读入、输出量较大，请使用<a href="https://oi-wiki.org/misc/io/" target="_blank">读入、输出优化</a>。</p><p>【样例说明】</p><p>第一个操作为<code>1 1 1 3</code>，即 $1 \rightarrow 2 \rightarrow 4$，因此答案为 $4$。</p><p>第九个操作后，序列变为<code>2 1&nbsp;2 1 2 1</code>。</p><p>第十个操作为<code>1 1 1 5</code>，即 $1 \rightarrow 5 \rightarrow 6$，因此答案为 $6$。</p>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>

</html>