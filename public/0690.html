<html>

<head>
	<meta charset="utf-8" />
	<link rel="icon" href="../image/favicon.ico" sizes="32x32" />
	<link rel="icon" href="../image/favicon.ico" sizes="192x192" />
	<link rel="stylesheet" type="text/css" href="../static/semantic.min.css">
	<script src="../static/jquery.min.js" type="text/javascript"></script>
	<script src="../static/semantic.min.js" type="text/javascript"></script>
	<title>[SDOI2017]苹果树</title>
	<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\(', '\)']]
  },
  svg: {
    fontCache: 'global'
  }
};
	</script>
	<script type="text/javascript" id="MathJax-script" async src="../static/es5/tex-svg.js"></script>
</head>

<body>
	<div class="ui three item menu"><a class="header item" href="../index.html"><img src="../image/favicon.ico"> Comet OJ</a>
	</div>
	<div class="ui main container">
		<div class="ui center aligned grid">
			<div class="row">
				<h1 class="ui header">C0690 [SDOI2017]苹果树</h1>
			</div>
				<div class="row" style="margin-top: -15px"><span class="ui label">内存限制：512 MB</span> <span class="ui label">时间限制：5000 ms</span></div>
		</div>
		<div class="ui grid">
			<div class="row">
				<div class="column">
					<h4 class="ui top attached block header">题目描述</h4>
					<div class="ui bottom attached segment font-content">
						<div style="position: relative; overflow: hidden;">
							<p>夏天近了，又到了恋爱的季节，小 Q 家门前的苹果树上结满了红红圆圆的苹果。</p><p>这株苹果树是一个有着$n$个结点的有根树，其中结点被依次编号为 $1$ 至 $n$。$1$ 号结点为根，其余每一个结点的父结点一定是某个编号较小的结点。每一个结点上都有一些苹果，第 $i$ 个结点上有 $a_i (a_i &gt; 0)$ 个苹果，每取走其中一个苹果就可以得到 $v_i (v_i &gt; 0)$ 的幸福度（若在这个结点取走 $k \leq a_i$ 个苹果，则可以收获 $kv_i$ 的幸福度）。如果在一个结点取走了至少一个苹果，则必须要在其父结点处取走至少一个苹果。</p><p>现在，给定正整数 $k$，请从树上取走若干苹果。如果总计取走了 $t$ 个苹果，且所有取了至少一个苹果的那些结点的最大深度为 $h$（这里规定根结点的深度为 $1$），则要求 $t − h \leq k$。问最大可以收获多少的幸福度？（这些幸福度全都归属于恋爱中的小 Q）</p>
						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="column">
					<h4 class="ui top attached block header">输入格式</h4>
						<div class="ui bottom attached segment font-content">
						<div style="position: relative; overflow: hidden;">
							<div class=content>
								<p>本题有多组测试数据，输入的第一行给定整数 $Q$ 表示有 $Q$ 组数据。之后依次给出 $Q$ 组数据。</p><p>对于每一组数据来说，第一行包含两个整数 $n$ 和 $k$。</p><p>之后 $n$ 行，每行给出三个整数，描述了每一个结点。其中第 $i$ 行的第一个整数给出了 $i$ 的父结点标号（如果 $i = 1$，则其父结点为 $0$），第二个整数为 $a_i$，第三个整数为 $v_i$。</p>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="column">
					<h4 class="ui top attached block header">输出</h4>
						<div class="ui bottom attached segment font-content">
						<div style="position: relative; overflow: hidden;">
							<div class=content>
								<p>输出一共有 $Q$ 行，对应了 $Q$ 组数据。</p><p>对于每一组数据，输出一个整数，表示最大可以收获的幸福度。</p>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="column">
					<h4 class="ui top attached block header">样例</h4>
						<div class="ui bottom attached segment font-content">
						<div style="position: relative; overflow: hidden;">
							<h4>样例输入 1</h4>
							<div class="ui existing segment">
								<pre style="margin-top:0; margin-bottom:0;"><code class="lang-plain"><div class=content><span class=sampledata>2
5 1
0 1 1
1 1 1
1 1 3
2 1 10
3 1 4
9 15
0 1 1
1 7 2
2 5 10
1 3 1
4 3 17
4 3 18
4 4 19
1 1 1
8 1 100</span></div></code></pre>
							</div>
							<h4>样例输出 1</h4>
							<div class="ui existing segment">
								<pre style="margin-top:0; margin-bottom:0;"><code class="lang-plain"><div class=content><span class=sampledata>15
316</span></div></code></pre>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="column">
					<h4 class="ui top attached block header">提示</h4>
						<div class="ui bottom attached segment font-content">
						<div style="position: relative; overflow: hidden;">
							<div class=content>
								<p>有 $10\%$ 的数据，满足 $nk \leq 3\,000\,000$ 且给定的树的高度为 $2$。</p><p>有 $20\%$ 的数据，满足 $nk \leq 25\,000\,000$ 且给定的树的高度为 $2$。</p><p>有 $20\%$ 的数据，满足 $nk \leq 25\,000\,000$ 且所有 $a_i$ 均为 $1$。</p><p>还有 $20\%$ 的数据，满足 $nk \leq 3\,000\,000$，没有上述额外限制。</p><p>对于 $100\%$ 的数据，满足 $1 \leq Q \leq 5$，$1 \leq n \leq 20\,000$，$1 \leq k \leq 500\,000$，$1 \leq nk \leq 25\,000\,000$，$1 \leq a_i \leq 10^8$，$1 \leq v_i \leq 100$。</p>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>

</html>