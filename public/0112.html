<html>

<head>
	<meta charset="utf-8" />
	<link rel="icon" href="../image/favicon.ico" sizes="32x32" />
	<link rel="icon" href="../image/favicon.ico" sizes="192x192" />
	<link rel="stylesheet" type="text/css" href="../static/semantic.min.css">
	<script src="../static/jquery.min.js" type="text/javascript"></script>
	<script src="../static/semantic.min.js" type="text/javascript"></script>
	<title>[CTSC2018]假面</title>
	<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\(', '\)']]
  },
  svg: {
    fontCache: 'global'
  }
};
	</script>
	<script type="text/javascript" id="MathJax-script" async src="../static/es5/tex-svg.js"></script>
</head>

<body>
	<div class="ui three item menu"><a class="header item" href="../index.html"><img src="../image/favicon.ico"> Comet OJ</a>
	</div>
	<div class="ui main container">
		<div class="ui center aligned grid">
			<div class="row">
				<h1 class="ui header">C0112 [CTSC2018]假面</h1>
			</div>
				<div class="row" style="margin-top: -15px"><span class="ui label">内存限制：512 MB</span> <span class="ui label">时间限制：6000 ms</span></div>
		</div>
		<div class="ui grid">
			<div class="row">
				<div class="column">
					<h4 class="ui top attached block header">题目描述</h4>
					<div class="ui bottom attached segment font-content">
						<div style="position: relative; overflow: hidden;">
							<p>针针是绿绿的好朋友。<br></p><p>针针喜欢玩一款叫做 DotA (Defense of the Algorithm) 的游戏，在这个游戏中，针针会操纵自己的英雄与队友一起对抗另一支队伍。 针针在 DotA 中最喜欢使用的英雄叫做假面（Faceless），该英雄有 2 个技能：</p><ul><li>锁定：对一名指定的敌方单位使用，以 $p$ 的概率对该单位造成 $1$ 点伤害（使其减少 $1$ 点生命值）。</li><li>结界：在一片区域施放结界，让该区域内的所有其他单位无法动弹。 在游戏中，如果一个单位的生命值降至 $0$ 或 $0$ 以下，那么该单位就会死亡。</li></ul><p>针针操纵假面的水平一般，因此他决定勤加练习。现在有 $n$ 个敌方单位（编号从 $1$ 至 $n$），编号为 $i$ 的敌方单位有 $h_i$​ 点生命值。</p><p>针针已经安排好了练习的计划，他会按顺序施放 $Q$ 个技能：</p><ul><li>对于锁定技能：针针会指定一个敌方单位 id，并对它施放。由于决定概率系数 $p$ 的因素很多，因此每次的 $p$ 都不一定相同。特别地，如果该敌方单位已经死亡，那么该技能不会造成任何效果。</li><li>对于结界技能：针针会希望对 $k$ 个指定的敌方单位施放，但由于针针并不擅长施放该技能，因此他只能命中恰好 $1$ 个敌方单位。命中每个存活的敌方单位的概率是相等的（也就是说已经死亡的敌方单位不会有任何影响）。 特别地，如果这 $k$ 个敌方单位均已死亡，那么该技能同样不会命中任何敌方单位。</li></ul><p>现在，围观针针进行练习的绿绿想知道：</p><ol><li>对于针针施放的每个结界技能，它命中各敌人的概率分别是多少。</li><li>在针针的所有技能施放完毕后，所有敌方单位剩余生命值的期望分别是多少。</li></ol><p>由于绿绿还要围观针针训练，所以请你帮他解决这两个问题。</p><p>为了防止精度误差，对于所有需要输出的数值，请输出其在模 $998244353$ 意义下的值。</p><p>由于结界为假面的终极技能，因此针针施放该技能的次数不会太多。具体请见“子任务”。</p>
						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="column">
					<h4 class="ui top attached block header">输入格式</h4>
						<div class="ui bottom attached segment font-content">
						<div style="position: relative; overflow: hidden;">
							<div class=content>
								<p>第 $1$ 行为 $1$ 个正整数 $n$，表示敌方单位的数量。</p><p>第 $2$ 行为 $n$ 个正整数 $m_1,⋯,m_n$，依次表示各敌方单位的初始生命值。</p><p>第 $3$ 行为 $1$ 个非负整数 $Q$，表示针针施放技能的数量。</p><p>第 $4$ 行至第 $Q+3$ 行，每行描述一个技能，第 $i+3$ 行描述第 $i$ 个技能。</p><ul><li>每行的开头为一个整数 $op$，表示该技能的种类。</li><li>如果 $op=0$，则表示锁定技能。并在此后跟随着 $3$ 个正整数 $id,u,v$，表示技能施放的目标为 $id$，技能命中的概率为 $p=\frac{u}{v}$​。（保证 $1≤id≤n,0&lt;u≤v&lt;998244353$）</li><li>如果 $op=1$，则表示结界技能。并在此后跟随着 $1$ 个正整数 $k$ 表示技能施放的目标数量，随后还有额外的 $k$ 个数 $id_1,⋯,id_k$ 描述技能施放的所有目标。（保证所有 $1≤id_i≤n$ 互不相同） 对于每一行，如果行内包含多个数，则用单个空格将它们隔开。</li></ul>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="column">
					<h4 class="ui top attached block header">输出</h4>
						<div class="ui bottom attached segment font-content">
						<div style="position: relative; overflow: hidden;">
							<div class=content>
								<p>输出包括 $C+1$ 行（其中 $C$ 为结界技能的数量）：</p><ul><li>前 $C$ 行依次对应每个结界技能，对于每行：</li><li>输出 $k$ 个数，第 $i$ 个数表示结界命中敌方单位 $id_i$ 的概率。<br>第 $C+1$ 行输出 $n$ 个数，第 $i$ 个数表示在所有技能施放完毕后，敌方单位 $i$ 剩余生命值的期望值。</li></ul><p>对于每一行，如果行内包含多个数，则用单个空格将它们隔开。</p><p>对于所有数值，请输出它们对 $998244353$ 取模的结果：即设答案化为最简分式后的形式为 $\frac{a}{b}$​，其中 $a$ 和 $b$ 的互质。输出整数 $x$ 使得 $bx≡a\mod998244353$ 且 $0≤x&lt;998244353$。（可以证明这样的整数 $x$ 是唯一的）</p>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="column">
					<h4 class="ui top attached block header">样例</h4>
						<div class="ui bottom attached segment font-content">
						<div style="position: relative; overflow: hidden;">
							<h4>样例输入 1</h4>
							<div class="ui existing segment">
								<pre style="margin-top:0; margin-bottom:0;"><code class="lang-plain"><div class=content><span class=sampledata>3
1 2 3
6
0 2 1 1
1 1 2
0 2 1 1
0 3 1 1
1 1 2
1 3 1 2 3</span></div></code></pre>
							</div>
							<h4>样例输出 1</h4>
							<div class="ui existing segment">
								<pre style="margin-top:0; margin-bottom:0;"><code class="lang-plain"><div class=content><span class=sampledata>1
0
499122177 0 499122177
1 0 2</span></div></code></pre>
							</div>
							<h4>样例输入 2</h4>
							<div class="ui existing segment">
								<pre style="margin-top:0; margin-bottom:0;"><code class="lang-plain"><div class=content><span class=sampledata>3
1 1 1
4
0 2 1 2
1 2 1 2
0 3 2 3
1 3 1 2 3</span></div></code></pre>
							</div>
							<h4>样例输出 2</h4>
							<div class="ui existing segment">
								<pre style="margin-top:0; margin-bottom:0;"><code class="lang-plain"><div class=content><span class=sampledata>249561089 748683265
804141285 887328314 305019108
1 499122177 332748118</span></div></code></pre>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="column">
					<h4 class="ui top attached block header">提示</h4>
						<div class="ui bottom attached segment font-content">
						<div style="position: relative; overflow: hidden;">
							<div class=content>
								<p>【样例 1 解释】</p><p>针针按顺序施放如下技能：</p><ol><li>对敌方单位 2 施放技能锁定：以 1 的概率对其造成 1 点伤害。此时 2 号敌方单位必定剩余 1 点生命值。</li><li>对敌方单位 2 施放技能结界：（由于 2 号敌方单位尚存活，）必定命中 2 号单位。</li><li>对敌方单位 2 施放技能锁定：以 1 的概率对其造成 1 点伤害。</li><li>对敌方单位 3 施放技能锁定：以 1 的概率对其造成 1 点伤害。此时三个敌方单位的生命值一定分别为 1,0,2，敌方单位 2 一定死亡。</li><li>对敌方单位 2 施放技能结界：（由于 2 号敌方单位已死亡，）必定不命中任何单位。</li><li>对敌方单位 1,2,3 施放技能结界：命中敌方单位 1,3 的概率是相等的，即各 $\frac{1}{2}$​。 最终，三个敌方单位的剩余生命值一定为 1,0,2。</li></ol><p>【样例 2 解释】</p><p>对于各结界技能的分析：</p><ol><li>第 1 个结界（目标为敌方单位 1,2 ）：<ul><li>2 号敌方单位存活的概率为 $\frac{1}{2}$​，1 号敌方单位必定存活。</li><li>如果 2 号敌方单位存活，那么结界命中 1,2 的概率相等，均为 $\frac{1}{2}$；如果 2 号敌方单位死亡，那么结界必定命中 1 号敌方单位。</li><li>因此：命中 1 号敌方单位的概率为 $\frac{1}{2}×1+\frac{1}{2}×\frac{1}{2}=\frac{3}{4}$；命中 2 号敌方单位的概率为 $\frac{1}{2}×0+\frac{1}{2}×\frac{1}{2}=\frac{1}{4}$。</li></ul></li><li>第 2 个结界（目标为敌方单位 1,2,3 ）：<ul><li>三个敌方单位存活的概率分别为 $1,\frac{1}{2},\frac{1}{3}$。</li><li>1,2,3 同时存活的概率为 $\frac{1}{6}$​；只有 1,2 存活的概率为 $\frac{1}{3}$​；只有 1,3 存活的概率为 $\frac{1}{6}$；只有 1 存活的概率为 $\frac{1}{3}$​。</li><li>因此：命中 1 号敌方单位的概率为 $\frac{1}{6}×\frac{1}{3}+(\frac{1}{3}+\frac{1}{6})×\frac{1}{2}+\frac{1}{3}×1=\frac{23}{36}$；命中 2 号敌方单位的概率为 $\frac{1}{6}×\frac{1}{3}+\frac{1}{3}×\frac{1}{2}=\frac{2}{9}$；命中 3 号敌方单位的概率为 $\frac{1}{6}×\frac{1}{3}+\frac{1}{6}×\frac{1}{2}=\frac{5}{36}$。 最终，三个敌方单位的剩余生命值的期望值为 $1,\frac{1}{2},\frac{1}{3}$。</li></ul></li></ol><p>【数据范围】</p><p>我们记 $C$ 为结界技能的数量。<br></p><p><img alt="屏幕快照 2019-07-09 上午11.10.04.png" src="../upload/81897433cb.png" width="700" height="476"><br></p><p>对于所有测试点，保证 $n≤200,Q≤200000,C≤1000,m_i≤100$。</p><p>【提示】</p><p></p><ul><li>第 3 个样例满足测试点 1 的数据规模限制。</li><li>$Q$ 的个位可以帮助你快速确定测试点的编号。<br></li><li>测试点顺序可能与难度无关。</li></ul>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>

</html>