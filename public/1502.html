<html>

<head>
	<meta charset="utf-8" />
	<link rel="icon" href="../image/favicon.ico" sizes="32x32" />
	<link rel="icon" href="../image/favicon.ico" sizes="192x192" />
	<link rel="stylesheet" type="text/css" href="../static/semantic.min.css">
	<script src="../static/jquery.min.js" type="text/javascript"></script>
	<script src="../static/semantic.min.js" type="text/javascript"></script>
	<title>[JLOI2010]足彩投注</title>
	<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\(', '\)']]
  },
  svg: {
    fontCache: 'global'
  }
};
	</script>
	<script type="text/javascript" id="MathJax-script" async src="../static/es5/tex-svg.js"></script>
</head>

<body>
	<div class="ui three item menu"><a class="header item" href="../index.html"><img src="../image/favicon.ico"> Comet OJ</a>
	</div>
	<div class="ui main container">
		<div class="ui center aligned grid">
			<div class="row">
				<h1 class="ui header">C1502 [JLOI2010]足彩投注</h1>
			</div>
				<div class="row" style="margin-top: -15px"><span class="ui label">内存限制：256 MB</span> <span class="ui label">时间限制：1000 ms</span></div>
		</div>
		<div class="ui grid">
			<div class="row">
				<div class="column">
					<h4 class="ui top attached block header">题目描述</h4>
					<div class="ui bottom attached segment font-content">
						<div style="position: relative; overflow: hidden;">
							<p>南非世界杯离我们越来越近了，与足球有紧密联系的足球彩票也越来越引起了人们的强烈关注。</p><p>了解足球彩票的人可能知道，足球彩票中有一种游戏叫做“胜负彩”，意为猜比赛的胜负。下面是一些与胜负彩有关的术语：</p><p>注：每一组有效组合数据。</p><p>投注：彩民以现金购买足球彩票的行为。</p><p>单式投注：彩民对于所有球队的比赛成绩均只选择一种预测结果的投注方式。投注的数量（注数）为 $1$。</p><p>复式投注：彩民对于某些场次的比赛成绩选择两种以上的预测结果的投注方式。投注的数量为复式投注的组合数。例如，某彩民对一场比赛预测了两个结果（例如，胜平），另一场比赛预测了三个结果（胜负平），其他比赛都只预测了一种结果，那么注数就是 $2×3 = 6$。这样的一个复式投注，可以看成一个包含六种单式投注的集合。</p><p>胜负彩的玩法一般是这样的。彩票机构指定一轮比赛中的若干场，让彩民去猜每场比赛的结果（胜、负、平）。根据彩民猜中比赛的场次，来确定中奖的额度。</p><p>我们现在考虑一个简化的模型。对于一轮比赛，彩民需要竞猜其中 $n$ 场比赛的结果，每场比赛的胜负平都有一个概率 $p(i, r)$。其中，$i$ 表示第 $i$ 场比赛。$r = 0, 1, 2$，分别表示比赛结果的（主队）负、平、胜。$p(i, r)$ 则表示第 $i$ 场比赛、结果为 $r$ 的概率。此外，还有一个概率 $q(i, r)$，表示第 $i$ 场比赛，投注购买结果为 $r$ 的概率。</p><p>例如，如果 $q(1,0) = 0.5$，我们可以知道第一场比赛有 $50\%$ 的投注会买主队输球。我们假设这 $n$ 场比赛互不相关，即 $p(i, r)$ 的结果不会受 $p(j, r')$ 的影响，$q(i, r)$ 的结果也不会受 $q(j, r')$ 的影响 $(r ≠ r')$。</p><p>在这个模型里，我们规定，必须猜中全部 $n$ 场比赛的结果才能获奖。总奖金为 $M$，由所有获奖的投注平分。因此，对于一个单式投注 $R_i = \{r_{i1}, r_{i2}, …, r_{in}\}$，$r_{ij}$表示投注 $R_i$ 对第 $j$ 场比赛的预测结果，它的中奖概率为：</p><p>$P(R_i)=\prod_{j=1}^np(j,r_{ij})$</p><p>设投注总数为N，那么中奖的投注总数为：</p><p>$N \cdot Q(R_i)=N \cdot \prod_{j=1}^nq(j,r_{ij})$</p><p>于是，投注 $R_i$ 所能得到的奖金的期望（平均意义下能够获得的奖金数）就是：</p><p>$\dfrac{M}{N \cdot Q(R_i)}\cdot P(R_i)$</p><p>以上考虑的仅仅是单式投注的情况，即仅考虑单注 $R_i$ 的中奖情况。对于复式投注，情况要复杂一些。采用复式投注时，投注的是一个集合 $R = \{R_1, R_2, …, R_k\}$，其中 $k$ 是投注的数量。例如，三场比赛，第一场猜“胜负”，第二场猜“平”，第三场猜“负平”，则 $k = 4$，$R$ 集合如下：</p><p>$R_1={r_{11}=0,r_{12}=1,r_{13}=0}$</p><p>$R_2={r_{21}=0,r_{22}=1,r_{23}=1}$</p><p>$R_3={r_{31}=2,r_{32}=1,r_{33}=0}$</p><p>$R_4={r_{41}=2,r_{42}=1,r_{43}=1}$</p><p>复式投注 $R$ 中，只要有一个 $R_i$ 猜对所有比赛结果，即可中奖。因此，复式投注 $R$ 所能获得的奖金的期望就是：</p><p>$\sum_{R_i \in R}\dfrac{M}{N \cdot Q(R_i)} \cdot P(R_i)$</p><p>我们的问题是，给定 $n$ 场比赛的信息（胜负平的概率和彩民购买三种结果的概率），以及复式投注中可以购买的最大注数 $U$，要求设计一种复式投注的方案，在不超过最大注数（复式投注的注数 $k≤U$）的前提下，使得获得奖金的期望最大。</p>
						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="column">
					<h4 class="ui top attached block header">输入格式</h4>
						<div class="ui bottom attached segment font-content">
						<div style="position: relative; overflow: hidden;">
							<div class=content>
								<p>第一行四个整数 $n, N, M, U(n, U ≤ 10^4, N, M ≤ 10^9)$。</p><p>以下 $n$ 行，每行六个实数。第 $i + 1$ 行的六个实数为 $p(i, 0), p(i, 1), p(i, 2), q(i, 0), q(i, 1)$ 和 $q(i, 2)$，用来描述第 $i$ 场比赛的相关信息。其中，$p(i, 0) + p(i, 1) + p(i, 2) = 1, q(i, 0) + q(i, 1) + q(i, 2) = 1, q(i, j) ≠ 0$。</p>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="column">
					<h4 class="ui top attached block header">输出</h4>
						<div class="ui bottom attached segment font-content">
						<div style="position: relative; overflow: hidden;">
							<div class=content>
								<p>一个实数，表示最大的将近期望的自然对数</p><p>$\ln(\max_{|R| \le U}{ \sum_{R_i \in R} \dfrac{M}{N \cdot Q(R_i)} \cdot P(R_i)})$</p><p>输出保留 $3$ 位小数（四舍五入）。</p>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="column">
					<h4 class="ui top attached block header">样例</h4>
						<div class="ui bottom attached segment font-content">
						<div style="position: relative; overflow: hidden;">
							<h4>样例输入 1</h4>
							<div class="ui existing segment">
								<pre style="margin-top:0; margin-bottom:0;"><code class="lang-plain"><div class=content><span class=sampledata>1 10 10 1
0.3 0.2 0.5 0.7 0.2 0.1</span></div></code></pre>
							</div>
							<h4>样例输出 1</h4>
							<div class="ui existing segment">
								<pre style="margin-top:0; margin-bottom:0;"><code class="lang-plain"><div class=content><span class=sampledata>1.609</span></div></code></pre>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="column">
					<h4 class="ui top attached block header">提示</h4>
						<div class="ui bottom attached segment font-content">
						<div style="position: relative; overflow: hidden;">
							<div class=content>
								
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>

</html>