<html>

<head>
	<meta charset="utf-8" />
	<link rel="icon" href="../image/favicon.ico" sizes="32x32" />
	<link rel="icon" href="../image/favicon.ico" sizes="192x192" />
	<link rel="stylesheet" type="text/css" href="../static/semantic.min.css">
	<script src="../static/jquery.min.js" type="text/javascript"></script>
	<script src="../static/semantic.min.js" type="text/javascript"></script>
	<title>[Contest #13]佛御石之钵-不碎的意志(困难版)</title>
	<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['$$$', '$$$']]
  },
  svg: {
    fontCache: 'global'
  }
};
	</script>
	<script type="text/javascript" id="MathJax-script" async src="../static/es5/tex-svg.js"></script>
</head>

<body>
	<div class="ui three item menu"><a class="header item" href="../index.html"><img src="../image/favicon.ico"> Comet OJ</a>
	</div>
	<div class="ui main container">
		<div class="ui center aligned grid">
			<div class="row">
				<h1 class="ui header">C1850 [Contest #13]佛御石之钵-不碎的意志(困难版)</h1>
			</div>
				<div class="row" style="margin-top: -15px"><span class="ui label">内存限制：256 MB</span> <span class="ui label">时间限制：2000 ms</span></div>
		</div>
		<div class="ui grid">
			<div class="row">
				<div class="column">
					<h4 class="ui top attached block header">题目描述</h4>
					<div class="ui bottom attached segment font-content">
						<div style="position: relative; overflow: hidden;">
							<p><strong>※ 简单版与困难版的唯一区别是 $n, m, q$ 的数据范围</strong></p><p>给一个 $n \times m$ 的网格，每个格子里有一个数字，非 $0$ 即 $1$，行从上往下依次编号为 $1, 2, \cdots, n$，列从左往右依次编号为 $1, 2, \cdots, m$。</p><p>给 $q$ 次操作，每次给定一个以 $(x_1,y_1)$ 为左上角，$(x_2,y_2)$ 为右下角的矩形内所有格子里的数字都变成 $1$。问每次操作之后，所有数字为 $1$ 的格子构成的四连通块的个数。</p><p>若不懂四连通块的定义可见最底下的提示。</p>
						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="column">
					<h4 class="ui top attached block header">输入格式</h4>
						<div class="ui bottom attached segment font-content">
						<div style="position: relative; overflow: hidden;">
							<div class=content>
								<p>输入第一行两个整数 $n,m~(1 \le n,m \le 1\,000)$，表示网格大小。</p><p>接下来 $n$ 行，每行一个长为 $m$ 的 01 串，表示初始网格。</p><p>接下来一行一个整数 $q~(1 \le q \le 30\,000)$，表示操作个数。</p><p>接下来 $q$ 行，每行四个整数 $x_1,y_1,x_2,y_2~(1 \le x_1 \le x_2 \le n, 1 \le y_1 \le y_2 \le m)$ 表示把以 $(x_1,y_1)$ 为左上角，$(x_2,y_2)$ 为右下角的矩形中的元素都变成 $1$。</p>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="column">
					<h4 class="ui top attached block header">输出</h4>
						<div class="ui bottom attached segment font-content">
						<div style="position: relative; overflow: hidden;">
							<div class=content>
								<p>输出共 $q$ 行，每行一个整数，表示每次操作后含有数字 $1$ 的格子构成的四连通块的个数。</p>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="column">
					<h4 class="ui top attached block header">样例</h4>
						<div class="ui bottom attached segment font-content">
						<div style="position: relative; overflow: hidden;">
							<h4>样例输入 1</h4>
							<div class="ui existing segment">
								<pre style="margin-top:0; margin-bottom:0;"><code class="lang-plain"><div class=content><span class=sampledata>5 6
101010
000001
101010
000001
101010
3
1 2 5 2
4 4 4 4
1 3 3 6</span></div></code></pre>
							</div>
							<h4>样例输出 1</h4>
							<div class="ui existing segment">
								<pre style="margin-top:0; margin-bottom:0;"><code class="lang-plain"><div class=content><span class=sampledata>6
7
2</span></div></code></pre>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="column">
					<h4 class="ui top attached block header">提示</h4>
						<div class="ui bottom attached segment font-content">
						<div style="position: relative; overflow: hidden;">
							<div class=content>
								<p>关于四连通块的定义如下：</p><p>先定义两个相异格子 $A$ 和 $B$ 相邻当且仅当 $A$ 和 $B$ 拥有恰一个公共边，也就是格子 $B$ 紧邻在 $A$ 的上、下、左、右四个方向之一。</p><p>若相异两格子 $A$ 和格子 $B$ 属于同一个四连通块当且仅当下两两个条件都满足：</p><ol><li><p>$A$ 和 $B$ 里的数字一样</p></li><li><p>$A$ 和 $B$ 相邻，或是存在 $k$ 个格子 $C_1, C_2, \ldots C_k$ ($k$ 可以是任意正整数。) 满足 $A$ 和 $C_1$ 相邻、$B$ 和 $C_k$ 相邻以及所有的 $C_i$ 和 $C_{i+1}$ 相邻($1 \le i &lt; k$)</p></li></ol>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>

</html>